@page "/register"
@model SmartKB.Pages.RegisterModel
<link rel="stylesheet" href="~/css/style.css" />

<div class="selection-screen">
    <div class="selection-card auth-card">
        <h1>Create your SmartKB account</h1>
        <form id="registerForm" class="auth-form">
            <label class="auth-label">
                <span>Email</span>
                <input id="registerEmail" type="email" required />
            </label>
            <label class="auth-label">
                <span>Password</span>
                <input id="registerPassword" type="password" required minlength="6" />
            </label>
            <div id="registerError" class="error-msg" style="display:none;"></div>
            <button type="submit" class="btn">
                <span class="btn-text">Register</span>
            </button>
            <p class="auth-switch">
                Already have an account?
                <a href="/login">Login</a>
            </p>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script type="module">
    import { register } from "/js/auth.js";

    const form = document.getElementById("registerForm");
    const emailInput = document.getElementById("registerEmail");
    const passwordInput = document.getElementById("registerPassword");
    const errorBox = document.getElementById("registerError");
    const btn = form.querySelector("button");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorBox.style.display = "none";
        errorBox.innerText = "";
        btn.disabled = true;
        btn.querySelector(".btn-text").textContent = "Creating account...";
        try {
            await register(emailInput.value.trim(), passwordInput.value);
            window.location.replace("/login");
        } catch (err) {
            btn.disabled = false;
            btn.querySelector(".btn-text").textContent = "Register";
            const errorMsg = err.response?.data?.message || err.response?.data || err.message || "Registration failed.";
            errorBox.innerText = typeof errorMsg === 'string' ? errorMsg : "Registration failed.";
            errorBox.style.display = "block";
        }
    });
</script>

