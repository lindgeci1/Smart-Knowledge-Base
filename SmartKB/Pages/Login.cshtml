@page "/login"
@model SmartKB.Pages.LoginModel
<link rel="stylesheet" href="~/css/style.css" />

<div class="selection-screen">
    <div class="selection-card auth-card">
        <h1>Login to SmartKB</h1>
        <form id="loginForm" class="auth-form">
            <label class="auth-label">
                <span>Email</span>
                <input id="loginEmail" type="email" required />
            </label>
            <label class="auth-label">
                <span>Password</span>
                <input id="loginPassword" type="password" required />
            </label>
            <div id="loginError" class="error-msg" style="display:none;"></div>
            <button type="submit" class="btn">
                <span class="btn-text">Login</span>
            </button>
            <p class="auth-switch">
                Need an account?
                <a href="/register">Register</a>
            </p>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script type="module">
    import { login } from "/js/auth.js";

    const form = document.getElementById("loginForm");
    const emailInput = document.getElementById("loginEmail");
    const passwordInput = document.getElementById("loginPassword");
    const errorBox = document.getElementById("loginError");
    const btn = form.querySelector("button");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorBox.style.display = "none";
        errorBox.innerText = "";
        btn.disabled = true;
        btn.querySelector(".btn-text").textContent = "Signing in...";
        try {
            await login(emailInput.value.trim(), passwordInput.value);
            window.location.replace("/file");
        } catch (err) {
            btn.disabled = false;
            btn.querySelector(".btn-text").textContent = "Login";
            const errorMsg = err.response?.data?.message || err.response?.data || err.message || "Login failed.";
            errorBox.innerText = typeof errorMsg === 'string' ? errorMsg : "Login failed.";
            errorBox.style.display = "block";
        }
    });
</script>

